# Docker Compose for ZimaOS / CasaOS
# Use this if you can't mount /etc/machine-id:ro
#
# Usage: docker compose -f docker-compose.casaos.yml up -d

services:
  hytale:
    image: ketbom/hytale-server:latest
    container_name: ${CONTAINER_NAME:-hytale-server}
    restart: on-failure
    stdin_open: true
    tty: true
    privileged: true
    ports:
      - "${BIND_PORT:-5520}:${BIND_PORT:-5520}/udp"
    environment:
      TZ: ${TZ:-UTC}
      JAVA_XMS: ${JAVA_XMS:-4G}
      JAVA_XMX: ${JAVA_XMX:-8G}
      BIND_PORT: ${BIND_PORT:-5520}
      BIND_ADDR: ${BIND_ADDR:-0.0.0.0}
      AUTO_DOWNLOAD: ${AUTO_DOWNLOAD:-true}
      USE_G1GC: ${USE_G1GC:-true}
      SERVER_EXTRA_ARGS: ${SERVER_EXTRA_ARGS:-}
    volumes:
      - ./server:/opt/hytale
      # NOTE: /etc/machine-id mount removed for ZimaOS/CasaOS compatibility
      # The container will generate and persist its own machine-id in ./server/.machine-id

  panel:
    image: ketbom/hytale-panel:latest
    container_name: hytale-panel
    restart: unless-stopped
    ports:
      - "${PANEL_PORT:-3000}:${PANEL_PORT:-3000}"
    environment:
      TZ: ${TZ:-UTC}
      CONTAINER_NAME: ${CONTAINER_NAME:-hytale-server}
      PANEL_PORT: ${PANEL_PORT:-3000}
      PANEL_USER: ${PANEL_USER:-admin}
      PANEL_PASS: ${PANEL_PASS:-admin}
      JWT_SECRET: ${JWT_SECRET:-}
      MODTALE_API_KEY: ${MODTALE_API_KEY:-}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    depends_on:
      - hytale
